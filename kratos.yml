# WARNING : this is an old and simple configuration files that I used during
# POC, this MUSN'T BE our configuration file
# TODO : put a real confiugration file in this repo

version: v0.8.0-alpha.3


serve:
  public:
    cors:
      enabled: true
      allowed_methods:
        - POST
        - GET
        - PUT
        - PATCH
        - DELETE
      allowed_headers:
        - Content-Type
        - Authorization
        - Cookie
      exposed_headers:
        - Content-Type
        - Set-Cookie
      #options_passthrough: true
      debug: true

selfservice:
  # whitelisted_return_urls:
  #   - https://r2devops.gridexx.fr
    
  methods:
    link:
      enabled: true
    profile:
      enabled: true
    password:
      enabled: true
    oidc:
      enabled: true
      config:
        providers:
          - id: gitlab # this is `<provider-id>` in the Authorization callback URL. DO NOT CHANGE IT ONCE SET!
            provider: gitlab
            # TODO : Paste your Application ID and Application secret here :
            client_id: #Application ID
            client_secret: #Secret
            mapper_url: file:///etc/config/kratos/oidc.gitlab.jsonnet
            scope:
              - openid
              - email


  flows:
    # All ui urls and browser return urls are defined with environnment variables
    verification:
      enabled: true

    login:
      lifespan: 10m
      after:
        password:
          hooks:
            - hook: require_verified_address

    settings:
      lifespan: 20m
      privileged_session_max_age: 1h

    registration:
      lifespan: 10m
      after:
        oidc:
          hooks:
            - hook: session
        # TODO : See how to add user fro self-hosted r2 inside sendinBlue
        # hooks:
        #   - hook: web_hook
        #     config:
        #       url: https://api.sendinblue.com/v3/contacts
        #       method: POST
        #       body: file:///etc/config/web_hook_sendinblue.jsonnet
        #       auth:
        #         type: api_key
        #         config:
        #           name: api-key
        #           in: header
        #           # value: set as secret in terraform configuration //TODO: check the value

    recovery:
      enabled: true


log:
  level: debug
  format: text
  leak_sensitive_values: true

identity:
  default_schema_url: file:///etc/config/kratos/identity.schema.json

courier:
  smtp:
    from_address: noreply@r2devops.io
    from_name: R2Devops
  template_override_path: /conf/courier-templates
  # templates:
  #   recovery:
  #     valid:
  #       subject: R2Devops - Recover access to your account
  #       body: file:///etc/config/kratos/courier/recovery.html.gotmpl
  #     invalid:
  #       subject: R2Devops - Account access attempted
  #       body: Hi, you (or someone else) entered this email address when trying to recover access to an account. However, this email address is not on our database of registered users and therefore the attempt has failed. If this was you, check if you signed up using a different address. If this was not you, please ignore this email.
  #       plainBody: Hi, you (or someone else) entered this email address when trying to recover access to an account.
  #     verification:
  #       valid:
  #         subject: "R2Devops - Activate your account"
  #         body: file:///etc/config/kratos/courier/verification.html.gotmpl
  #       invalid:
  #         subject: "R2Devops - Account activation attempted"
  #         body: Hi, you (or someone else) entered this email address when trying to activate an account. However, this email address is not on our database of registered users and therefore the attempt has failed. If this was you, check if you signed up using a different address. If this was not you, please ignore this email.
  #         plainBody: Hi, you (or someone else) entered this email address when trying to activate an account.
          